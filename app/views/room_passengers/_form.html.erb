<script type="text/javascript">
$(function() {

  passengers  = <%= raw(passengers_as_json( @passengers )) %>;

  $('#passenger_search').typeahead({
    
    source: function (query, process) {
      matches = [];
      map = {};
   
      $.each(passengers, function (i, passenger) {
        // var passenger_denomination = passenger.dni + ' (' + passenger.name + ')';
        map[passenger.passenger_denomination] = passenger;
        matches.push(passenger.passenger_denomination);
      });
   
      process(matches);
    },
    
    updater: function (item) {
      selected = map[item].passenger_id;
      $('#reservation_passenger_id').val( selected );
      $('#room_passenger_passenger_dni').val( map[item].dni );
      return item;
    },
    
    matcher: function (item) {
      if (item.toLowerCase().indexOf(this.query.trim().toLowerCase()) != -1) {
        return true;
      }
    },
    
    sorter: function (items) {
        return items.sort();
    },
    
    highlighter: function (item) {
      var regex = new RegExp( '(' + this.query + ')', 'gi' );
      return item.replace( regex, "<strong>$1</strong>" );
    },
  
  });
});
</script>

<%= form_for @room_passenger, html: {class: "form-horizontal"} do |f| %>
  
  <% if @room_passenger.errors.any? %>
    <div class="alert alert-error">
      <button type="button" class="close" data-dismiss="alert">×</button>
      <h3>Se encontraron <%= @room_passenger.errors.count %> errores:</h3>
      <ul>
      <% @room_passenger.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <% if notice %>
    <div class="alert alert-success">
      <button type="button" class="close" data-dismiss="alert">×</button>
      <p><%= notice %></p>
    </div>
  <% end %>


  <%= f.fields_for :passenger do |passenger| %>

  <div class="control-group">
    <%= passenger.label :passenger_id, 'Pasajero', { class: 'control-label' } %>
    <div class="controls">
      <input id="passenger_search" placeholder="Buscar..." class="" type="text" name="">
      <%= passenger.hidden_field :passenger_id  %>
    </div>
  </div>
    
  <div class="control-group">
    <%= passenger.label :dni, { class: 'control-label' } %>
    <div class="controls">
      <%= passenger.text_field :dni %>
    </div>
  </div>

  <div class="control-group">
    <%= passenger.label :name, { class: 'control-label' } %>
    <div class="controls">
      <%= passenger.text_field :name %>
    </div>
  </div>

  <div class="control-group">
    <%= passenger.label :lastname, { class: 'control-label' } %>
    <div class="controls">
      <%= passenger.text_field :lastname %>
    </div>
  </div>

  <div class="control-group">
    <%= passenger.label :phone_number, { class: 'control-label' } %>
    <div class="controls">
      <%= passenger.text_field :phone_number %>
    </div>
  </div>

  <div class="control-group">
    <%= passenger.label :birthdate, { class: 'control-label' } %>
    <div class="controls">
      <%= passenger.text_field :birthdate %>
    </div>
  </div>

  <div class="control-group">
    <%= passenger.label :nationality, { class: 'control-label' } %>
    <div class="controls">
      <%= passenger.text_field :nationality %>
    </div>
  </div>

  <div class="control-group">
    <%= passenger.label :country, { class: 'control-label' } %>
    <div class="controls">
      <%= passenger.text_field :country %>
    </div>
  </div>

  <div class="control-group">
    <%= passenger.label :province, { class: 'control-label' } %>
    <div class="controls">
      <%= passenger.text_field :province %>
    </div>
  </div>

  <div class="control-group">
    <%= passenger.label :city, { class: 'control-label' } %>
    <div class="controls">
      <%= passenger.text_field :city %>
    </div>
  </div>

  <div class="control-group">
    <%= passenger.label :address, { class: 'control-label' } %>
    <div class="controls">
      <%= passenger.text_field :address %>
    </div>
  </div>

  <div class="control-group">
    <%= passenger.label :proffesion, { class: 'control-label' } %>
    <div class="controls">
      <%= passenger.text_field :proffesion %>
    </div>
  </div>

  <div class="control-group">
    <%= passenger.label :civil_status, { class: 'control-label' } %>
    <div class="controls">
      <%= passenger.text_field :civil_status %>
    </div>
  </div>

  <% end %>


  <%= f.fields_for :reservation_room do |reservation_room| %>

  <div class="control-group">
    <%= f.label :reservation_room_id, { class: 'control-label' } %>
    <div class="controls">
      <%= f.text_field :reservation_room_id %>
    </div>
  </div>

  <% end %>


  <div class="form-actions">
    <%= f.submit "Guardar", { class: 'btn btn-primary' } %>
    <%= link_to 'Atras', room_passengers_path, { class: 'btn' } %>
  </div>

<% end %>
